# Plano de Teste para Model (Sprint 4) 

| Funcionalidade                  | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|---------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Cadastro de usuário        | Um usuário só pode ser cadastrado se possuir nome, e-mail único e senha               | Tentar salvar usuário sem `nome`, `email` ou `senha`                | A operação deve falhar com erro de validação (`required`) ou de unicidade (`unique`)                |
| Cadastro válido            | Um usuário com nome, e-mail único e senha válida deve ser salvo com sucesso           | Inserir um usuário com todos os campos preenchidos corretamente      | O usuário é salvo e retornado com `_id`, `ehAdmin` e `ativo` padrão como `false`                     |
| Senha criptografada        | A senha do usuário deve ser armazenada de forma criptografada                         | Cadastrar usuário e verificar campo `senha` no banco                 | O campo `senha` não deve ser igual ao valor informado, deve estar criptografado                     |
| E-mail único               | Não deve ser possível cadastrar dois usuários com o mesmo e-mail                      | Tentar cadastrar dois usuários com o mesmo e-mail                    | A segunda operação deve falhar com erro de unicidade (`unique`)                                     |
| Valor padrão ehAdmin       | Ao cadastrar um usuário sem informar `ehAdmin`, o valor padrão deve ser `false`       | Cadastrar usuário sem o campo `ehAdmin`                              | O campo `ehAdmin` deve estar como `false` no documento salvo                                         |
| Valor padrão ativo         | Ao cadastrar um usuário sem informar `ativo`, o valor padrão deve ser `false`         | Cadastrar usuário sem o campo `ativo`                                | O campo `ativo` deve estar como `false` no documento salvo                                         |
| Leitura de usuários        | O sistema deve retornar todos os usuários cadastrados                                 | Fazer find() e verificar leitura dos dados inseridos                 | A resposta contém um array com os usuários cadastrados                                              |
| Atualização de usuário     | Deve ser possível atualizar informações de um usuário válido, exceto e-mail e senha   | Fazer updateOne() / findByIdAndUpdate()                             | O usuário deve refletir os dados alterados, exceto `email` e `senha`                                |
| Proibição de update email  | Não deve ser possível alterar o e-mail de um usuário                                  | Tentar atualizar o campo `email`                                     | O campo `email` permanece inalterado após a operação                                                |
| Proibição de update senha  | Não deve ser possível alterar a senha de um usuário por update direto                 | Tentar atualizar o campo `senha`                                     | O campo `senha` permanece inalterado após a operação                                                |
| Soft delete de usuário     | Um usuário deve ser desativado (ativo=false) ao invés de removido fisicamente         | Fazer update com `ativo: false`                                     | O usuário permanece no banco com campo `ativo` como `false`                                         |
| Restauração de usuário     | Um usuário desativado pode ser reativado (ativo=true)                                 | Fazer update com `ativo: true` em usuário desativado                | O usuário fica com campo `ativo` como `true` e volta a ser utilizável                               |
| Relacionamento com cursos  | Um usuário pode ter múltiplos cursos associados via `cursosIds`                       | Associar cursos ao usuário e verificar o array `cursosIds`           | O array `cursosIds` contém os ids dos cursos associados corretamente                                |
| Progresso em cursos        | Um usuário pode ter seu progresso registrado em diferentes cursos                     | Adicionar registros de progresso e verificar o array `progresso`     | O array `progresso` contém informações de percentual e referência aos cursos corretamente           |
| Populate de cursos         | Usuário deve retornar dados populados dos cursos relacionados                         | Buscar usuário e verificar se cursosIds contém objetos completos     | Os cursosIds retornam objetos com titulo, cargaHorariaTotal e status dos cursos                     |
| Populate de progresso      | Progresso deve retornar dados populados dos cursos relacionados                       | Buscar usuário e verificar se progresso.curso contém objetos completos| Os objetos de progresso retornam curso com titulo e cargaHorariaTotal                               |

# Plano de Teste Controller (Sprint 5)

| Funcionalidade              | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|----------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Validação de schema        | Deve validar o schema de entrada (nome, email, senha obrigatórios)                    | Enviar requisição com dados inválidos                               | Deve retornar erro 400 para dados inválidos                                                         |
| E-mail já cadastrado       | Não deve permitir cadastro com e-mail já existente                                    | Enviar requisição com e-mail já cadastrado                          | Deve retornar erro 409 para e-mail já cadastrado                                                    |
| Usuário não encontrado     | Deve retornar erro ao buscar, atualizar ou deletar usuário inexistente                | Buscar, atualizar ou deletar usuário inexistente                    | Deve retornar erro 404 para usuário não encontrado                                                   |
| Resposta sem senha         | Não deve retornar o campo `senha` nas respostas                                       | Cadastrar, listar, atualizar usuário                                | O campo `senha` não aparece nas respostas                                                           |
| Mensagens padronizadas     | Mensagens de sucesso e erro devem ser claras e padronizadas                           | Realizar operações de sucesso e erro                                | Mensagens seguem o padrão definido                                                                  |
| Dados inválidos no cadastro| Deve retornar erro 400 ao tentar cadastrar usuário com dados ausentes ou inválidos    | Enviar requisição sem nome, email ou senha                          | Deve retornar erro 400 para dados inválidos                                                         |
| Atualização proibida        | Deve retornar erro ao tentar atualizar e-mail ou senha diretamente                    | Tentar atualizar campo `email` ou `senha`                           | Deve ignorar alteração, mantendo valores originais e informando via mensagem                        |
| Falha inesperada            | Deve retornar erro 500 para falhas inesperadas no controller                          | Simular erro inesperado em qualquer operação                        | Deve retornar erro 500 e mensagem padronizada                                                       |
| Busca com filtro inválido   | Deve retornar erro 400 ao buscar usuários com filtros inválidos                        | Buscar usuários com query inválida                                  | Deve retornar erro 400 para filtros inválidos                                                       |
| Soft delete de usuário      | Deve desativar usuário (ativo=false) ao invés de remover fisicamente                  | Fazer DELETE /usuarios/:id                                          | Deve retornar usuário com ativo=false e status 200                                                  |
| Restauração de usuário      | Deve reativar usuário desativado via endpoint específico                              | Fazer PATCH /usuarios/:id/restaurar                                 | Deve retornar usuário com ativo=true e status 200                                                   |
| Remoção física de usuário   | Deve remover fisicamente usuário via endpoint específico                              | Fazer DELETE /usuarios/:id/permanente                               | Deve retornar status 200 e usuário não deve existir mais no banco                                   |
| Enriquecimento de dados    | Deve enriquecer os dados do usuário com estatísticas de progresso                     | Listar usuários com cursos e progresso                             | As respostas contêm o campo `estatisticasProgresso` com cursosIniciados, cursosConcluidos, etc      |
| Filtro por status ativo    | Deve filtrar usuários ativos corretamente                                             | Buscar com query ?ativo=true                                        | Retorna apenas usuários com ativo=true                                                              |
| Filtro por status inativo  | Deve filtrar usuários inativos corretamente                                           | Buscar com query ?ativo=false                                       | Retorna apenas usuários com ativo=false                                                             |
| Filtro por ehAdmin         | Deve filtrar usuários administradores corretamente                                    | Buscar com query ?ehAdmin=true                                      | Retorna apenas usuários com ehAdmin=true                                                            |
| Filtro por data de criação | Deve filtrar usuários por período de criação                                          | Buscar com query ?dataInicio=2024-01-01&dataFim=2024-12-31         | Retorna apenas usuários criados no período especificado                                             |
| Ordenação de resultados    | Deve ordenar resultados por campos válidos                                            | Buscar com query ?ordenarPor=nome&direcao=asc                       | Retorna usuários ordenados pelo campo especificado na direção solicitada                           |
| Populate de dados relacionais| Deve retornar dados populados dos cursos nos campos cursosIds e progresso            | Buscar usuário individual ou em lista                               | cursosIds e progresso.curso retornam objetos completos com titulo, cargaHorariaTotal, etc          |

# Plano de Teste Service (Sprint 5)

| Funcionalidade              | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|----------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Criptografia de senha      | Deve criptografar a senha antes de salvar                                             | Cadastrar usuário e verificar campo `senha`                         | O campo `senha` está criptografado                                                                  |
| Proibição de update email  | Deve impedir alteração de e-mail via update                                           | Tentar atualizar o campo `email`                                    | O campo `email` permanece inalterado após a operação                                                |
| Proibição de update senha  | Deve impedir alteração de senha via update                                            | Tentar atualizar o campo `senha`                                    | O campo `senha` permanece inalterado após a operação                                                |
| Unicidade de e-mail        | Deve validar unicidade do e-mail                                                      | Cadastrar dois usuários com o mesmo e-mail                          | A segunda operação falha com erro de unicidade                                                      |
| Usuário inexistente        | Deve lançar erro se usuário não existir ao atualizar ou deletar                       | Atualizar ou deletar usuário inexistente                            | Deve retornar erro 404 para usuário não encontrado                                                   |
| Falha na criptografia da senha | Deve lançar erro se a senha não puder ser criptografada                              | Simular falha no bcrypt.hash                                        | Deve lançar exceção e não salvar usuário                                                            |
| Erro inesperado do repository | Deve lançar erro se o repository lançar exceção em qualquer operação                  | Simular erro lançado pelo repository                               | Deve lançar erro e não comprometer a integridade dos dados                                          |
| Update com campos proibidos   | Deve ignorar alterações em e-mail e senha mesmo se enviados no update                 | Tentar atualizar campos `email` e `senha` via update                | Campos permanecem inalterados após a operação                                                        |
| Verificação de existência    | Deve verificar se usuário existe antes de atualizar ou deletar                        | Chamar atualizar ou deletar com id inválido                         | Deve chamar ensureUserExists e lançar erro 404 se usuário não existir                               |
| Soft delete via service     | Deve desativar usuário (ativo=false) ao invés de remover fisicamente                  | Chamar método deletar do service                                    | Usuário fica com ativo=false no banco de dados                                                      |
| Restauração via service     | Deve reativar usuário desativado via método restaurar                                 | Chamar método restaurar do service                                  | Usuário fica com ativo=true no banco de dados                                                       |
| Verificação de dependências | Deve verificar dependências antes de exclusão física                                  | Tentar excluir fisicamente usuário com progresso ou cursos criados  | Deve lançar erro de conflito para usuários com dependências                                         |
| Exclusão física em transação| Deve executar exclusão física dentro de transação atômica                            | Executar exclusão física completa                                   | Todas as operações são executadas ou todas são revertidas                                           |

# Plano de Teste Repository (Sprint 5)

| Funcionalidade              | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|----------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Buscar por e-mail           | Deve buscar usuário por e-mail corretamente                                           | Buscar usuário pelo campo `email`                                   | Retorna o usuário correto                                                                            |
| Buscar por id               | Deve buscar usuário por id corretamente                                              | Buscar usuário pelo campo `_id`                                     | Retorna o usuário correto                                                                            |
| Aplicar filtros de busca    | Deve aplicar filtros de busca (nome, email, ativo, ehAdmin)                           | Buscar usuários com diferentes filtros                              | Retorna apenas os usuários que atendem aos filtros                                                   |
| Paginação de resultados     | Deve aplicar limite e página na listagem de usuários                                 | Listar usuários com parâmetros page e limite                        | Retorna resultados paginados conforme solicitado                                                    |
| Erro para operações inválidas| Deve retornar erro apropriado para operações inválidas                               | Buscar, atualizar ou deletar usuário inexistente                    | Deve retornar erro 404 para usuário não encontrado                                                   |
| Buscar por e-mail inexistente| Deve retornar null ou lançar erro ao buscar usuário por e-mail inexistente             | Buscar usuário com e-mail não cadastrado                            | Retorna null ou lança erro 404 quando flag throwErrorIfNotFound=true                               |
| Buscar por id inexistente    | Deve lançar erro ao buscar usuário por id inexistente                                | Buscar usuário com id não cadastrado                                | Deve lançar erro 404                                                                                |
| Soft delete no repository   | Deve alterar campo ativo para false ao invés de remover registro                      | Chamar método deletar do repository                                 | Usuário permanece no banco com ativo=false                                                          |
| Restauração no repository   | Deve alterar campo ativo para true para reativar usuário                              | Chamar método restaurar do repository                               | Usuário fica com ativo=true no banco                                                                |
| Exclusão física no repository| Deve remover fisicamente o registro do banco                                         | Chamar método deletarFisicamente do repository                      | Usuário é removido permanentemente do banco                                                         |
| Erro inesperado do banco     | Deve lançar erro se o banco lançar exceção em qualquer operação                      | Simular falha do banco de dados                                     | Deve lançar erro e não comprometer a integridade dos dados                                           |
| Enriquecimento de dados     | Deve calcular e adicionar estatísticas de progresso detalhadas                        | Chamar enriquecerUsuario para um usuário                            | Retorna objeto com estatisticasProgresso contendo cursosIniciados, cursosConcluidos, etc             |
| Filtro de nome              | Deve filtrar usuários por nome corretamente                                          | Listar usuários com filtro de nome                                  | Retorna apenas usuários cujo nome corresponde ao filtro                                             |
| Filtro de email             | Deve filtrar usuários por email corretamente                                         | Listar usuários com filtro de email                                 | Retorna apenas usuários cujo email corresponde ao filtro                                            |
| Filtro por status ativo     | Deve filtrar usuários por campo ativo corretamente                                   | Listar usuários com filtro ativo=true/false                         | Retorna apenas usuários com o valor de ativo especificado                                           |
| Filtro por ehAdmin          | Deve filtrar usuários administradores corretamente                                   | Listar usuários com filtro ehAdmin=true/false                       | Retorna apenas usuários com o valor de ehAdmin especificado                                         |
| Filtro por período de criação| Deve filtrar usuários por data de criação                                           | Listar usuários com dataInicio e dataFim                            | Retorna apenas usuários criados no período especificado                                             |
| Ordenação de resultados     | Deve ordenar resultados por campos válidos                                           | Listar usuários com ordenarPor e direcao                            | Retorna usuários ordenados pelo campo e direção especificados                                       |
| Populate automático de cursos| Deve popular automaticamente dados dos cursos relacionados                           | Buscar usuário com cursosIds ou progresso                           | cursosIds e progresso.curso retornam objetos completos dos cursos                                   |
| Populate em operações de escrita| Deve retornar dados populados em operações de atualização e soft delete            | Atualizar, deletar ou restaurar usuário                             | Operações retornam usuário com dados de cursos populados            


# Plano de Teste ENDPOINT (Sprint 6)
