# Plano de Teste para Model (Sprint 4) 

| Funcionalidade                  | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|---------------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Cadastro de curso          | Um curso só pode ser cadastrado se possuir título e criadoPorId                     | Tentar salvar curso sem `titulo` ou `criadoPorId`                     | A operação deve falhar com erro de validação (`required`)                |
| Cadastro válido            | Um curso com título único, carga horária e criadoPorId deve ser salvo com sucesso     | Inserir um curso com todos os campos obrigatórios preenchidos        | O curso é salvo e retornado com `_id` e estatísticas                      |
| Status padrão             | Ao criar curso sem informar status, ele deve ser "ativo" por padrão                  | Cadastrar curso sem especificar o status                           | O curso é salvo com status "ativo"                                                                |
| Título único               | Não deve ser possível cadastrar dois cursos com o mesmo título                        | Tentar cadastrar dois cursos com o mesmo título                     | A segunda operação deve falhar com erro de validação                                               |
| Validade da carga horária  | A carga horária total é opcional, deve ser maior ou igual a 0, com valor padrão 0  | Tentar cadastrar curso com carga horária negativa ou omitindo o campo | Se omitido, o valor padrão 0 é usado; se negativo, falha com erro de validação (`min`)          |
| Referência ao criador      | Deve haver uma referência válida ao usuário que criou o curso                         | Verificar campo `criadoPorId` no documento salvo                    | O campo `criadoPorId` deve ser um ObjectId válido referenciando um usuário existente                |
| Campos opcionais           | Deve ser possível salvar curso sem os campos opcionais                               | Cadastrar curso sem campos como `descricao`, `thumbnail`, etc.       | O curso é salvo sem problemas com os campos obrigatórios                                           |
| Arrays vazios              | Ao cadastrar um curso sem informar arrays, eles devem ser inicializados vazios        | Cadastrar curso sem `materialComplementar`, `professores` e `tags`   | Os arrays são inicializados como vazios no documento salvo                                          |
| Material complementar     | Deve tratar corretamente os casos de material vazio, undefined ou com conteúdo        | Cadastrar cursos com as três variações de material complementar     | O filtro temMaterialComplementar funciona corretamente para todas as variações                       |
| Leitura de cursos          | O sistema deve retornar todos os cursos cadastrados                                  | Fazer find() e verificar leitura dos dados inseridos                 | A resposta contém um array com os cursos cadastrados                                               |
| Atualização de curso       | Deve ser possível atualizar informações de um curso válido                           | Fazer updateOne() / findByIdAndUpdate()                             | O curso deve refletir os dados alterados                                |
| Remoção de curso           | Um curso existente pode ser removido do sistema se não houver dependências           | Fazer deleteOne() / findByIdAndDelete()                             | O curso é removido e não aparece mais na listagem                                                |
| Campo cargaHorariaTotal    | O campo deve ser atualizado automaticamente quando aulas são adicionadas/removidas  | Adicionar/remover aulas relacionadas ao curso                      | O campo cargaHorariaTotal é automaticamente atualizado                                         |
| Atomicidade na exclusão    | Ao excluir um curso em uma transação, deve ser tudo ou nada                        | Excluir um curso dentro de uma transação e simular erro            | Ou todas as entidades são excluídas ou nenhuma é excluída                                        |

# Plano de Teste Controller (Sprint 5)

| Funcionalidade              | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|----------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Validação de schema        | Deve validar o schema de entrada (título, carga horária e criadoPorId obrigatórios)   | Enviar requisição com dados inválidos                               | Deve retornar erro 400 para dados inválidos                                                         |
| Título já cadastrado       | Não deve permitir cadastro com título já existente                                    | Enviar requisição com título já cadastrado                          | Deve retornar erro 400 para título já cadastrado                                                   |
| Curso não encontrado       | Deve retornar erro ao buscar, atualizar ou deletar curso inexistente                  | Buscar, atualizar ou deletar curso inexistente                      | Deve retornar erro 404 para curso não encontrado                                                   |
| Mensagens padronizadas     | Mensagens de sucesso e erro devem ser claras e padronizadas                           | Realizar operações de sucesso e erro                                | Mensagens seguem o padrão definido                                                                  |
| Dados inválidos no cadastro| Deve retornar erro 400 ao tentar cadastrar curso com dados ausentes ou inválidos      | Enviar requisição sem título, carga horária ou criadoPorId           | Deve retornar erro 400 para dados inválidos                                                         |
| Falha inesperada           | Deve retornar erro 500 para falhas inesperadas no controller                         | Simular erro inesperado em qualquer operação                        | Deve retornar erro 500 e mensagem padronizada                                                       |
| Busca com filtro inválido  | Deve retornar erro 400 ao buscar cursos com filtros inválidos                        | Buscar cursos com query inválida                                    | Deve retornar erro 400 para filtros inválidos                                                      |
| Filtros AND de tags        | Deve retornar apenas cursos que possuem todas as tags especificadas                  | Testar com tag1=js&tag2=node ou tags[]=js&tags[]=node              | Retorna apenas cursos que possuem ambas as tags                                                    |
| Filtro de material boolean | Deve converter strings para boolean corretamente no filtro temMaterialComplementar   | Testar com 'true', '1', 'false', '0'                               | Strings são convertidas corretamente para boolean                                                  |
| Filtros de data UTC        | Deve interpretar datas em formato UTC corretamente                                   | Testar criadoApos=2023-01-01T00:00:00Z                             | Filtra corretamente por data UTC                                                                   |
| Remoção de curso inexistente | Deve retornar erro 404 ao tentar remover curso inexistente                          | Tentar deletar curso com id inexistente                             | Deve retornar erro 404 para curso não encontrado                                                  |
| Enriquecimento de dados    | Deve enriquecer os dados do curso com estatísticas completas                        | Listar cursos                                                      | As respostas contêm campos calculados como `totalAulas`, `totalQuestionarios`, `totalAlternativas`, `totalCertificados` e duração formatada |
| Ordenação por campos       | Deve ordenar resultados por diferentes campos                                       | Testar ordenarPor=titulo&direcaoOrdem=desc                         | Resultados são ordenados conforme solicitado                                                       |
| Status padrão na listagem  | Deve retornar apenas cursos ativos quando status não especificado                   | Listar cursos sem filtro de status                                 | Retorna apenas cursos ativos por padrão                                                           |
| Update sem dados           | Deve retornar erro ao tentar atualizar um curso sem fornecer novos dados             | Enviar requisição de atualização com corpo vazio                     | Deve retornar erro 400 informando necessidade de pelo menos um campo para atualização            |
| Bloqueio de exclusão       | Deve impedir exclusão de curso com usuários com progresso significativo              | Tentar excluir curso com usuário com progresso > 30%                | Deve retornar erro 409 (Conflict) com mensagem adequada                                          |
| Estatísticas na exclusão   | Ao excluir um curso, deve retornar estatísticas do que foi excluído                  | Excluir um curso com aulas, questionários, alternativas e certificados | Resposta contém contagens de entidades excluídas                                                  |

# Plano de Teste Service (Sprint 5)

| Funcionalidade              | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|----------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Validação de título único  | Deve validar se título já está em uso antes de salvar ou atualizar                   | Cadastrar dois cursos com mesmo título                              | A segunda operação falha com erro de validação                                                     |
| Verificação de existência  | Deve verificar se o curso existe antes de atualizar ou deletar                        | Tentar atualizar ou deletar curso inexistente                       | Deve lançar erro 404 para curso não encontrado                                                     |
| Validação de criador | Deve validar se o usuário criador existe ao criar ou atualizar um curso | Tentar criar/atualizar curso com ID de usuário inexistente | A operação deve falhar com erro de validação (BAD_REQUEST) |
| Unicidade de título        | Não deve permitir atualização que resultaria em título duplicado                      | Tentar atualizar curso com título já utilizado                      | A operação falha com erro de validação                                                            |
| Curso inexistente          | Deve lançar erro se curso não existir ao atualizar ou deletar                         | Atualizar ou deletar curso inexistente                              | Deve retornar erro 404 para curso não encontrado                                                   |
| Exclusão em cascata | Ao excluir um curso, deve excluir todas suas dependências (aulas, questionários, alternativas, certificados) | Excluir um curso que possui aulas, questionários, alternativas e certificados | Todas as entidades dependentes são excluídas e a operação retorna estatísticas |
| Bloqueio de exclusão | Não deve permitir excluir curso com usuários com progresso significativo | Tentar excluir curso que possui usuários com progresso > 30% | Deve retornar erro 409 (CONFLICT) com mensagem sobre progresso significativo |
| Atomicidade na exclusão | Se ocorrer erro durante exclusão em cascata, deve reverter todas as alterações | Simular erro durante exclusão em cascata | A transação é revertida e nenhuma entidade é excluída |
| Erro inesperado do repository | Deve lançar erro se o repository lançar exceção em qualquer operação              | Simular erro lançado pelo repository                               | Deve lançar erro e não comprometer a integridade dos dados                                          |
| Remoção de referências em usuários | Ao excluir um curso, deve remover referências em usuários | Excluir um curso que possui referências em usuários | As referências ao curso são removidas dos usuários (cursosIds e progresso) |
| Tratamento de erros | Deve propagar erros apropriadamente sem try/catch desnecessários | Verificar como erros são tratados no service | Erros são propagados corretamente e apenas try/catch necessários para transação |

# Plano de Teste Repository (Sprint 5)

| Funcionalidade              | Comportamento Esperado                                                                 | Verificações                                                        | Critérios de Aceite                                                                                 |
|----------------------------|--------------------------------------------------------------------------------------|---------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------|
| Buscar por título          | Deve buscar curso por título corretamente                                             | Buscar curso pelo campo `titulo`                                    | Retorna o curso correto                                                                            |
| Buscar por id              | Deve buscar curso por id corretamente                                                | Buscar curso pelo campo `_id`                                       | Retorna o curso correto                                                                            |
| Aplicar filtros de busca   | Deve aplicar filtros de busca (título, tags, professores, carga horária)             | Buscar cursos com diferentes filtros                                | Retorna apenas os cursos que atendem aos filtros                                                   |
| Filtros de tags (AND/OR)   | Deve aplicar filtros AND (todas as tags) ou OR (qualquer tag)                       | Testar variações: tag1/tag2/tag3, tags[], todasTags                | Retorna resultados corretos conforme o tipo de filtro (AND ou OR)                                  |
| Filtros de professores     | Deve aplicar filtros AND (todos professores) ou OR (qualquer professor)             | Testar variações: professor1/2/3, professores[], todosProfessores   | Retorna resultados corretos conforme o tipo de filtro (AND ou OR)                                  |
| Filtro temMaterialComplementar | Deve filtrar cursos com ou sem material complementar                             | Testar com valores true/false/'true'/'false'/'1'/'0'                | Conversão correta de strings para booleanos e filtragem adequada                                    |
| Filtros de data            | Deve filtrar corretamente por datas de criação e atualização                        | Testar criadoApos, criadoAntes, atualizadoApos                     | Retorna cursos apenas do período especificado                                                     |
| Filtro de status           | Deve filtrar por status e mostrar apenas cursos ativos por padrão                   | Testar cada status e ausência de filtro de status                   | Por padrão mostra apenas ativos; com filtro, mostra apenas do status solicitado                    |
| Paginação de resultados    | Deve aplicar limite e página na listagem de cursos                                   | Listar cursos com parâmetros page e limite                          | Retorna resultados paginados conforme solicitado                                                    |
| Ordenação de resultados    | Deve ordenar por campo e direção especificados                                      | Testar ordenação por diferentes campos e direções                   | Resultados ordenados conforme solicitado                                                           |
| Erro para operações inválidas| Deve retornar erro apropriado para operações inválidas                              | Buscar, atualizar ou deletar curso inexistente                      | Deve retornar erro 404 para curso não encontrado                                                   |
| Buscar por id inexistente  | Deve lançar erro ao buscar curso por id inexistente                                  | Buscar curso com id não cadastrado                                  | Deve lançar erro 404                                                                                |
| Buscar por título inexistente | Deve lançar erro ao buscar curso por título inexistente                          | Buscar curso com título não cadastrado                              | Deve lançar erro 404 para curso não encontrado                                                     |
| Remoção de curso inexistente | Deve lançar erro ao tentar remover curso inexistente                               | Tentar deletar curso com id inexistente                             | Deve lançar erro 404                                                                               |
| Erro inesperado do banco     | Deve lançar erro se o banco lançar exceção em qualquer operação                     | Simular falha do banco de dados                                     | Deve lançar erro e não comprometer a integridade dos dados                                         |
| Enriquecimento de dados     | Deve calcular e adicionar estatísticas completas ao curso | Chamar enriquecerCurso para um curso | Retorna objeto com estatísticas calculadas corretamente incluindo totalAulas, totalQuestionarios, totalAlternativas, totalCertificados e duração formatada |
| Enriquecimento de dados assíncrono | Deve funcionar corretamente com múltiplas chamadas assíncronas | Enriquecer múltiplos cursos usando Promise.all | Todos os cursos são enriquecidos corretamente com estatísticas |
| Uso da cargaHorariaTotal | Deve usar o campo cargaHorariaTotal armazenado ao invés de recalcular | Verificar método enriquecerCurso | O método não recalcula a carga horária, mas usa o campo armazenado |
| Formatação da duração | Deve formatar a duração corretamente em horas e minutos | Chamar formatarDuracao com diferentes valores | Retorna strings formatadas corretamente (ex: "2h 30min", "45min", "0min") |
| Comportamento padrão de status | Deve retornar apenas cursos ativos quando status não é especificado | Listar cursos sem filtro de status | Retorna apenas cursos ativos e cursos sem status definido |
| Filtros especiais no builder | Deve construir corretamente filtros que exigem tratamento especial | Testar build() com filtros como quantidadeAulas e sort | Retorna estrutura com filtros normais e especiais separados |
| Combinações de filtros | Deve aplicar corretamente múltiplos filtros em uma mesma consulta | Combinar filtros de tags, professores, datas e status | Retorna apenas cursos que atendem a todos os critérios combinados |


# Plano de Teste ENDPOINT (Sprint 6)
